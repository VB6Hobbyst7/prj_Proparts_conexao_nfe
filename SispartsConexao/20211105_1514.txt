Public Sub TratamentoDeDadosGerais()
If DLookup("[ValorDoParametro]", "[tblParametros]", "[TipoDeParametro]='processamentoLog'") Then TextFile_Append CurrentProject.path & "\" & strLog(), "######## - TratamentoDeDadosGerais()"
Dim qryProcessos() As Variant: qryProcessos = Array( _
                                                qryDadosGerais_Update_FornecedoresValidos, _
                                                qryDadosGerais_Update_RegistrosValidos, _
                                                qryDadosGerais_Update_IdTipo, _
                                                qryDadosGerais_Update_RetornoArmazem, _
                                                qryDadosGerais_Update_TransferenciaSisparts, _
                                                qryDadosGerais_Update_CTe, _
                                                qryDadosGerais_Update_Sit_CompraNF, _
                                                qryDadosGerais_Update_IdEmpresa, _
                                                qryDadosGerais_Update_IdEmpresa_TransferenciaEntreFiliais, _
                                                qryDadosGerais_Update_IDVD, _
                                                qryDadosGerais_Update_IdFornCompraNF, _
                                                qryDadosGerais_Update_ID_NatOp_CompraNF__FiltroCFOP): executarComandos qryProcessos

End Sub





'' SELEÇÃO DE FORNECEDORES VALIDOS
Private Const qryDadosGerais_Update_FornecedoresValidos As String = _
        "UPDATE (SELECT STRPontos(tmpClientes.CNPJ_CPF) AS strCNPJ_CPF FROM tmpClientes) AS qryFornecedoresValidos INNER JOIN tblDadosConexaoNFeCTe ON qryFornecedoresValidos.strCNPJ_CPF = tblDadosConexaoNFeCTe.CNPJ_emit SET tblDadosConexaoNFeCTe.registroValido = 1 WHERE ((tblDadosConexaoNFeCTe.registroProcessado) = 0);"


'' SELEÇÃO DE REGISTROS VALIDOS.qryRegistrosValidos
Private Const qryDadosGerais_Update_RegistrosValidos As String = _
        "UPDATE (SELECT STRPontos(tmpEmpresa.CNPJ_Empresa) AS strCNPJ_CPF FROM tmpEmpresa) AS qryRegistrosValidos INNER JOIN tblDadosConexaoNFeCTe ON qryRegistrosValidos.strCNPJ_CPF = tblDadosConexaoNFeCTe.CNPJ_emit SET tblDadosConexaoNFeCTe.registroValido = 1;"


'' TIPOS DE CADASTRO - tblTipos
Private Const qryDadosGerais_Update_IdTipo As String = _
        "UPDATE tblDadosConexaoNFeCTe SET tblDadosConexaoNFeCTe.ID_Tipo = 0 WHERE (((tblDadosConexaoNFeCTe.ID_Tipo) Is Null));"


'' RELACIONAR COM ID DE TIPOS DE CADASTROS (tblTipos) - 4 - NF-e Retorno Armazém -> ( ID_Tipo: 5 )
Private Const qryDadosGerais_Update_RetornoArmazem As String = _
        "UPDATE tblDadosConexaoNFeCTe SET tblDadosConexaoNFeCTe.ID_Tipo = DLookUp(""[ValorDoParametro]"", ""[tblParametros]"", ""[TipoDeParametro]='RetornoArmazem'"") WHERE (((tblDadosConexaoNFeCTe.ID_Tipo) = 0) AND ((tblDadosConexaoNFeCTe.codMod) = CInt('55')) AND ((tblDadosConexaoNFeCTe.CNPJ_emit) IN ('12680452000302')));"


'' RELACIONAR COM ID DE TIPOS DE CADASTROS (tblTipos) - 6 - NF-e Transferência com código Sisparts -> ( ID_Tipo: 7 )
Private Const qryDadosGerais_Update_TransferenciaSisparts As String = _
        "UPDATE tblDadosConexaoNFeCTe SET tblDadosConexaoNFeCTe.ID_Tipo = DLookUp(""[ValorDoParametro]"", ""[tblParametros]"", ""[TipoDeParametro]='TransferenciaSisparts'"") WHERE (((tblDadosConexaoNFeCTe.ID_Tipo) = 0) AND ((tblDadosConexaoNFeCTe.codMod) = CInt('55')) AND ((tblDadosConexaoNFeCTe.CNPJ_emit) IN (SELECT CNPJ_Empresa FROM [tmpEmpresa])));"


'' RELACIONAR COM ID DE TIPOS DE CADASTROS (tblTipos) - 0 - CT-e -> ( ID_Tipo: 1 )
Private Const qryDadosGerais_Update_CTe As String = _
        "UPDATE tblDadosConexaoNFeCTe SET tblDadosConexaoNFeCTe.ID_Tipo = DLookUp(""[ValorDoParametro]"", ""[tblParametros]"", ""[TipoDeParametro]='CTe'"") WHERE (((tblDadosConexaoNFeCTe.ID_Tipo) = 0) AND ((tblDadosConexaoNFeCTe.codMod) = CInt('57')));"


'' CONTROLE DE FINALIDADES
Private Const qryDadosGerais_Update_Sit_CompraNF As String = "UPDATE  ( SELECT   " & _
        "                 strSplit(ValorDoParametro,'|',0) AS strFinalidade,  strSplit(ValorDoParametro,'|',1) AS strSit_CompraNF   " & _
        "                FROM   " & _
        "                  tblParametros   " & _
        "                WHERE   " & _
        "                  TipoDeParametro='Sit_CompraNF'  " & _
        "              )  AS qrySit_CompraNF   " & _
        "INNER JOIN   " & _
        "   (   SELECT  *   " & _
        "       FROM  tblDadosConexaoNFeCTe   " & _
        "       WHERE tblDadosConexaoNFeCTe.registroValido IN (SELECT TOP 1 cint(tblParametros.ValorDoParametro) FROM [tblParametros] WHERE TipoDeParametro = 'registroValido')   " & _
        "   )  AS tmpDadosConexaoNFeCTe  " & _
        "ON (cint(qrySit_CompraNF.strFinalidade) = tmpDadosConexaoNFeCTe.ID_TIPO)  " & _
        "SET  tmpDadosConexaoNFeCTe.Sit_CompraNF = [qrySit_CompraNF].[strSit_CompraNF];  "


'' -- FiltroFil
'' #tblDadosConexaoNFeCTe.ID_Empresa
'' -- CTE
Private Const qryDadosGerais_Update_IdEmpresa As String = _
        "UPDATE (SELECT tmpEmpresa.ID_Empresa, STRPontos(tmpEmpresa.CNPJ_Empresa) AS strCNPJ_CPF FROM tmpEmpresa) AS qryEmpresas " & _
        " INNER JOIN tblDadosConexaoNFeCTe ON qryEmpresas.strCNPJ_CPF = tblDadosConexaoNFeCTe.CNPJ_Rem " & _
        " SET tblDadosConexaoNFeCTe.ID_Empresa = qryEmpresas.ID_Empresa;"

'' #tblDadosConexaoNFeCTe.ID_Empresa
Private Const qryDadosGerais_Update_IdEmpresa_TransferenciaEntreFiliais As String = _
        "UPDATE (SELECT tmpEmpresa.ID_Empresa, STRPontos(tmpEmpresa.CNPJ_Empresa) AS strCNPJ_CPF FROM tmpEmpresa) AS qryEmpresas " & _
        " INNER JOIN tblDadosConexaoNFeCTe ON qryEmpresas.strCNPJ_CPF = tblDadosConexaoNFeCTe.CPNJ_Dest " & _
        " SET tblDadosConexaoNFeCTe.ID_Empresa = qryEmpresas.ID_Empresa" & _
        " WHERE (((tblDadosConexaoNFeCTe.CFOP) = '6152'));"

'' #20210823_qryDadosGerais_Update_IDVD
'' #tblDadosConexaoNFeCTe.IDVD_CompraNF
Private Const qryDadosGerais_Update_IDVD As String = _
    "UPDATE tblDadosConexaoNFeCTe " & _
    "SET tblDadosConexaoNFeCTe.IDVD_CompraNF = val((Left(Trim(Replace(Replace(tblDadosConexaoNFeCTe.Obs_CompraNF, 'PEDIDO: ', ''), 'PEDIDO ', '')), 6))) " & _
    "WHERE (((Left(tblDadosConexaoNFeCTe.Obs_CompraNF, 6)) = 'PEDIDO ') " & _
    "       AND ((tblDadosConexaoNFeCTe.CNPJ_emit) = '12680452000302') " & _
    "       AND (((tblDadosConexaoNFeCTe.registroValido) = 1)  " & _
    "       AND ((tblDadosConexaoNFeCTe.registroProcessado) = 0))  " & _
    "       AND ((tblDadosConexaoNFeCTe.ID_Tipo) > 0));"


'' #20210823_qryDadosGerais_Update_IdFornCompraNF
'' #tblDadosConexaoNFeCTe.ID_Forn_CompraNF
Private Const qryDadosGerais_Update_IdFornCompraNF As String = _
        "UPDATE (SELECT STRPontos(tmpClientes.CNPJ_CPF) AS strCNPJ_CPF, tmpClientes.CÓDIGOClientes FROM tmpClientes) AS qryClientesFornecedor " & _
        "INNER JOIN tblDadosConexaoNFeCTe ON tblDadosConexaoNFeCTe.CNPJ_emit = qryClientesFornecedor.strCNPJ_CPF " & _
        "SET tblDadosConexaoNFeCTe.ID_Forn_CompraNF = qryClientesFornecedor.CÓDIGOClientes;"


'' #20210823_qryDadosGerais_Update_ID_NatOp_CompraNF__FiltroCFOP -- FiltroCFOP
'' #tblDadosConexaoNFeCTe.FiltroCFOP
'' #tmpDadosConexaoNFeCTe.ID_NatOp_CompraNF
'' RELACIONAMENTO DE CFOP PARA DENTRO E FORA DO ESTADO
Private Const qryDadosGerais_Update_ID_NatOp_CompraNF__FiltroCFOP As String = _
            "UPDATE  ( SELECT " & _
            "           tmpNatOp.ID_NatOper, tmpNatOp.Fil_NatOper, tmpNatOp.CFOP_NatOper, qryPscPes.strXMLCFOP, qryPscPes.strEstado  " & _
            "       FROM (SELECT  " & _
            "               strSplit(ValorDoParametro,'|',0) AS strFil_NatOper,  strSplit(ValorDoParametro,'|',1) AS strEstado,  strSplit(ValorDoParametro,'|',2) AS strXMLCFOP,  strSplit(ValorDoParametro,'|',3) AS strCFOP_NatOper  " & _
            "             FROM  " & _
            "               tblParametros  " & _
            "             WHERE  " & _
            "               TipoDeParametro='FiltroFil' And strSplit(ValorDoParametro,'|',0) In ('PSC','PES'))  AS qryPscPes  " & _
            "       INNER JOIN tmpNatOp ON (qryPscPes.strCFOP_NatOper = tmpNatOp.CFOP_NatOper) AND (qryPscPes.strFil_NatOper = tmpNatOp.Fil_NatOper) )  AS tmpPscPes  " & _
            "INNER JOIN  " & _
            "   (   SELECT  *  " & _
            "       FROM  tblDadosConexaoNFeCTe  " & _
            "       WHERE tblDadosConexaoNFeCTe.registroValido IN (SELECT TOP 1 cint(tblParametros.ValorDoParametro) FROM [tblParametros] WHERE TipoDeParametro = 'registroValido')  " & _
            "       AND tblDadosConexaoNFeCTe.ID_NatOp_CompraNF IS NULL )  AS tmpDadosConexaoNFeCTe " & _
            "ON (tmpPscPes.strXMLCFOP = tmpDadosConexaoNFeCTe.CFOP) AND (tmpPscPes.Fil_NatOper = tmpDadosConexaoNFeCTe.ID_Empresa) " & _
            "SET  tmpDadosConexaoNFeCTe.ID_NatOp_CompraNF = [tmpPscPes].[ID_NatOper], tmpDadosConexaoNFeCTe.FiltroCFOP = [tmpPscPes].[CFOP_NatOper];"
