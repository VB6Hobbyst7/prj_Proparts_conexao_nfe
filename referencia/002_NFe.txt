Segue abaixo a função atual do meu sistema que gera o NFe no banco de dados, vai ajudar a preencher todos os campos que ficaram vazios ou divergentes.
Segue em anexo planilha com alguns NFes importados pela sua função em comparação com o que já estava correto no banco de dados SispartsN para vc comparar e corrigir sua função.
Na planilha tbm tem os itens equivalentes no SispartsN, assim vc consegue comparar se está fazendo correto.
 
Ficar atento às finalidades e as diferenças de dados em cada finalidade.
 
Estarei à disposição o final de semana todo para tirar suas dúvidas.
11 99885-5033
 
Tem mais alguns poucos detalhes para encerrar, vou preparar em outro email amanhã.
Acredito que com esses dois e-mails que estou enviando agora vc vai conseguir finalizar 95% do trabalho.
A ideia sempre foi pegar o que já está pronto no meu sistema e adaptar nas suas funções.
 
ElseIf Me.Finalidade = 1 Or Me.Finalidade = 3 Or Me.Finalidade = 4 Or Me.Finalidade = 5 Or Me.Finalidade = 6 Or Me.Finalidade = 7 Then
    If Me.Finalidade = 6 Then
        Me.FiltroCFOP = DLookup("[ID_NatOper]", "tblNatOp", "[CFOP_NatOper]='2.152' and [Fil_NatOper]='" & Me.FiltroFil & "'")
        Me.FiltroCFOP.Requery
    ElseIf Me.Finalidade = 7 Then
        Me.FiltroCFOP = DLookup("[ID_NatOper]", "tblNatOp", "[CFOP_NatOper]='2.557' and [Fil_NatOper]='" & Me.FiltroFil & "'")
        Me.FiltroCFOP.Requery
    End If
  
    
    CurrentDb.Execute "DELETE * FROM 05_XML_ICMS"
    CurrentDb.Execute "DELETE * FROM 05_XML_IPI"
 
    rsCompraNF.CursorType = adOpenKeyset
    rsCompraNF.LockType = adLockOptimistic
    rsCompraNF.Open "SELECT TOP 1 * FROM tblCompraNF ORDER BY NumPed_CompraNF DESC;", CNN
    Dim NumPed As Long
    NumPed = rsCompraNF!NumPed_CompraNF
   
    rsCompraNF.AddNew
    OK | rsCompraNF!Fil_CompraNF = Me.FiltroFil
    OK | rsCompraNF!NumNF_CompraNF = XMLNumNF
    OK | rsCompraNF!NumPed_CompraNF = Format(NumPed + 1, "000000")
    OK | rsCompraNF!ModeloDoc_CompraNF = 55
    OK | rsCompraNF!Serie_CompraNF = XMLSerie
    #AILTON | OK | rsCompraNF!TPNF_CompraNF = 1
    OK | rsCompraNF!ID_NatOp_CompraNF = Me.FiltroCFOP.Column(0)
    OK | rsCompraNF!CFOP_CompraNF = Me.FiltroCFOP.Column(1)
    OK | rsCompraNF!DTEmi_CompraNF = XMLDTEmi
    If Me.Finalidade = 4 Then
        #AILTON | OK | rsCompraNF!DTEntd_CompraNF = Date
    ElseIf Me.Finalidade = 1 Or Me.Finalidade = 3 Or Me.Finalidade = 6 Then
    Else
        #AILTON | OK | rsCompraNF!DTEntd_CompraNF = XMLDTEmi
    End If
    #AILTON | OK | rsCompraNF!Obs_CompraNF = Mid(XMLinfAdFisco, 1, 255)
   
    
    Dim Parts() As String
    Dim NumAtual As String
  
    If XMLinfAdFisco <> "" Then
        Parts = Split((XMLinfAdFisco), ",")
        NumAtual = Parts(LBound(Parts))
        If Forms!frmCompraNF_ImpXML!Finalidade = 4 Then
            #AILTON | OK | rsCompraNF!IDVD_CompraNF = Replace(NumAtual, "Pedido:", "")
        End If
    End If
    'rsCompraNF!IDVD_CompraNF = XMLinfAdFisco
       
    #AILTON | OK | rsCompraNF!ID_Forn_CompraNF = IDCadFor
    OK | rsCompraNF!BaseCalcICMS_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotICMS_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotServ_CompraNF = 0
    If Forms!frmCompraNF_ImpXML!Finalidade = 4 Then
        OK | rsCompraNF!VTotProd_CompraNF = XMLvNF
        OK | rsCompraNF!VTotNF_CompraNF = XMLvNF
        OK | rsCompraNF!HoraEntd_CompraNF = XMLdhSaiEnt
    Else
        OK | rsCompraNF!VTotProd_CompraNF = 0
        OK | rsCompraNF!VTotNF_CompraNF = 0
    End If
    If Forms!frmCompraNF_ImpXML!Finalidade = 4 Then
        #AILTON | OK | rsCompraNF!Sit_CompraNF = 6
    Else
        #AILTON | OK | rsCompraNF!Sit_CompraNF = 5
    End If
    OK | rsCompraNF!ChvAcesso_CompraNF = XMLChave
    #AILTON | OK | rsCompraNF!BaseCalcICMSSubsTrib_CompraNF = 0
    OK | rsCompraNF!VTotICMSSubsTrib_CompraNF = 0
    If EstáAberto("formVendas") Then
        rsCompraNF!VTotFrete_CompraNF = Forms!formVendas!Transporte * -1
    Else
        rsCompraNF!VTotFrete_CompraNF = 0
    End If
    #AILTON | OK | rsCompraNF!VTotSeguro_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotOutDesp_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotIPI_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotISS_CompraNF = 0
    #AILTON | OK | rsCompraNF!TxDesc_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotDesc_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotISS_CompraNF = 0
    #AILTON | OK | rsCompraNF!VTotISS_CompraNF = 0
    rsCompraNF.Update       ' Salva alterações.
    IDCompraNF = rsCompraNF!ID_CompraNF
    Me.ID = IDCompraNF
   
    If XMLqVol <> "" Then
        rsCompraNFVol.CursorType = adOpenKeyset
        rsCompraNFVol.LockType = adLockOptimistic
        rsCompraNFVol.CursorLocation = adUseClient
        rsCompraNFVol.Open "SELECT TOP 1 * FROM tblCompraNFVol", CNN, , , adCmdText
       
        rsCompraNFVol.AddNew
        rsCompraNFVol!ID_CompraNF_CompraNFVol = IDCompraNF
        rsCompraNFVol!Item_CompraNFVol = 1
        rsCompraNFVol!QtdVol_CompraNFVol = XMLqVol
        rsCompraNFVol!EspVol_CompraNFVol = XMLEsp
        rsCompraNFVol!MarcaVol_CompraNFVol = "Proparts"
        rsCompraNFVol!NumeroVol_CompraNFVol = 0
        rsCompraNFVol!PesoBrt_CompraNFVol = XMLPesoB
        rsCompraNFVol!PesoLiq_CompraNFVol = XMLPesoL
        rsCompraNFVol.Update
        rsCompraNFVol.Close
    End If
   
    If Me.Finalidade = 1 Or Me.Finalidade = 3 Or Me.Finalidade = 4 Or Me.Finalidade = 5 Or Me.Finalidade = 6 Or Me.Finalidade = 7 Then
        Imp_Prod_ICMS (DocXML)
        Imp_Prod_IPI (DocXML)
        If EstáAberto("formVendas") Then
            X = PegaTagProdVd(DocXML, IDCompraNF, IDCadFor)
        Else
            X = PegaTagProdXML(DocXML, IDCompraNF, IDCadFor)
        End If
    End If
 
    rsCompraNF.Close
    rsCad.Close
    If EstáAberto("formVendas") Then
    Else
        DoCmd.SetWarnings False
        DoCmd.OpenQuery "qryCompraNF_ImpXML_BCICMS"
        DoCmd.OpenQuery "qryCompraNF_ImpXML_IPI"
        DoCmd.SetWarnings True
    End If
 
ElseIf Me.Finalidade = 2 Then
    CurrentDb.Execute "DELETE * FROM 04_XML_prod"
    CurrentDb.Execute "DELETE * FROM 05_XML_ICMS"
    CurrentDb.Execute "DELETE * FROM 05_XML_IPI"
   
    rsCompraNF.CursorType = adOpenKeyset
    rsCompraNF.LockType = adLockOptimistic
    rsCompraNF.Open "SELECT TOP 1 * FROM tblCompraNF ORDER BY NumPed_CompraNF DESC;", CNN
    NumPed = rsCompraNF!NumPed_CompraNF
   
    rsCompraNF.AddNew
    #AILTON | OK | rsCompraNF!Fil_CompraNF = Me.FiltroFil
    OK | rsCompraNF!NumNF_CompraNF = XMLNumNF
    OK | rsCompraNF!NumPed_CompraNF = Format(NumPed + 1, "000000")
    OK | rsCompraNF!ModeloDoc_CompraNF = 55
    OK | rsCompraNF!Serie_CompraNF = XMLSerie
    #AILTON | OK | rsCompraNF!TPNF_CompraNF = 1
    OK | rsCompraNF!ID_NatOp_CompraNF = Me.FiltroCFOP.Column(0)
    OK | rsCompraNF!CFOP_CompraNF = Me.FiltroCFOP.Column(1)
    OK | rsCompraNF!DTEmi_CompraNF = XMLDTEmi
    OK | rsCompraNF!DTEntd_CompraNF = XMLDTEmi
       
    OK | rsCompraNF!ID_Forn_CompraNF = IDCadFor
    If EstáAberto("formVendas") Then
        OK | rsCompraNF!BaseCalcICMS_CompraNF = 0
    Else
        OK | rsCompraNF!BaseCalcICMS_CompraNF = 0
    End If
    OK | rsCompraNF!VTotICMS_CompraNF = 0
    OK | rsCompraNF!VTotServ_CompraNF = 0
    OK | rsCompraNF!VTotProd_CompraNF = 0
    OK | rsCompraNF!VTotNF_CompraNF = 0
    OK | rsCompraNF!Sit_CompraNF = 5
    OK | rsCompraNF!ChvAcesso_CompraNF = XMLChave
    OK | rsCompraNF!BaseCalcICMSSubsTrib_CompraNF = 0
    OK | rsCompraNF!VTotICMSSubsTrib_CompraNF = 0
    OK | rsCompraNF!VTotFrete_CompraNF = 0
    OK | rsCompraNF!VTotSeguro_CompraNF = 0
    OK | rsCompraNF!VTotOutDesp_CompraNF = 0
    OK | rsCompraNF!VTotIPI_CompraNF = 0
    OK | rsCompraNF!VTotISS_CompraNF = 0
    OK | rsCompraNF!TxDesc_CompraNF = 0
    OK | rsCompraNF!VTotDesc_CompraNF = 0
    OK | rsCompraNF!VTotISS_CompraNF = 0
    OK | rsCompraNF!VTotISS_CompraNF = 0
    rsCompraNF.Update       ' Salva alterações.
    IDCompraNF = rsCompraNF!ID_CompraNF
    Me.ID = IDCompraNF
   
    If XMLqVol <> "" Then
        rsCompraNFVol.CursorType = adOpenKeyset
        rsCompraNFVol.LockType = adLockOptimistic
        rsCompraNFVol.CursorLocation = adUseClient
        rsCompraNFVol.Open "SELECT TOP 1 * FROM tblCompraNFVol", CNN, , , adCmdText
       
        rsCompraNFVol.AddNew
        rsCompraNFVol!ID_CompraNF_CompraNFVol = IDCompraNF
        rsCompraNFVol!Item_CompraNFVol = 1
        rsCompraNFVol!QtdVol_CompraNFVol = XMLqVol
        rsCompraNFVol!EspVol_CompraNFVol = XMLEsp
        rsCompraNFVol!MarcaVol_CompraNFVol = "Proparts"
        rsCompraNFVol!NumeroVol_CompraNFVol = 0
        rsCompraNFVol!PesoBrt_CompraNFVol = XMLPesoB
        rsCompraNFVol!PesoLiq_CompraNFVol = XMLPesoL
        rsCompraNFVol.Update
        rsCompraNFVol.Close
    End If
   
    If Me.Finalidade = 2 Then
        Imp_Prod_NF (DocXML)
        Imp_Prod_ICMS (DocXML)
        Imp_Prod_IPI (DocXML)
        CadProdXMLConsumo (IDCadFor)
        If EstáAberto("formVendas") Then
            X = PegaTagProdVd(DocXML, IDCompraNF, IDCadFor)
        Else
            X = PegaTagProdXML(DocXML, IDCompraNF, IDCadFor)
        End If
    End If
      
End If