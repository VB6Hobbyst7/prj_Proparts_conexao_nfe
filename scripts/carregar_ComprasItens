Public Function carregar_ComprasItens(pPathFile As String)
On Error Resume Next


    '' carregarParametros (qrySelectProcessamentoItensCompras)
Dim t As Variant

For Each t In carregarParametros(qrySelectProcessamentoItensCompras)

    Debug.Print CStr(t)

Next t


'' CHAVES DE CONTROLE
Dim pPK As String: pPK = DLookup("[Chave]", "[tblDadosConexaoNFeCTe]", "[CaminhoDoArquivo]='" & pPathFile & "'")
Dim pChvAcesso As String: pChvAcesso = DLookup("[ChvAcesso]", "[tblDadosConexaoNFeCTe]", "[CaminhoDoArquivo]='" & pPathFile & "'")

'' controle do xml
Dim XDoc As Object: Set XDoc = CreateObject("MSXML2.DOMDocument"): XDoc.async = False: XDoc.validateOnParse = False
XDoc.Load pPathFile

Dim cont As Integer: cont = XDoc.getElementsByTagName("infNFe/det").Length
Dim Item As Variant

Dim pDados As New Collection

Dim idItem As String: idItem = ""

    '' LIMPAR TABELA DE PROCESSAMENTOS
    Application.CurrentDb.Execute qryDeleteProcessamento
    
    '' IDENTIFICAÇÃO DO ARQUIVO
    pDados.add pPK & "|" & "CaminhoDoArquivo" & "|" & pPathFile
    
    '' CHAVE DE ACESSO
    pDados.add pPK & "|" & "ChvAcesso_CompraNF" & "|" & pChvAcesso
    
    For i = 0 To cont - 1
        '' ID
        idItem = CStr(XDoc.getElementsByTagName("nfeProc/NFe/infNFe/det").Item(i).Attributes(0).value)
        pDados.add pPK & "_" & idItem & "|" & "Item_CompraNFItem" & "|" & idItem
        pDados.add pPK & "_" & idItem & "|" & "ChvAcesso_CompraNF" & "|" & pChvAcesso
        
        '' CAMPOS DO REGISTRO
        For Each Item In carregarParametros(qryTags, "tblCompraNFItem")
            pDados.add pPK & "_" & idItem & "|" & Item & "|" & XDoc.SelectNodes("nfeProc/NFe/infNFe/det").Item(i).SelectNodes(Item).Item(0).text
        Next Item
                
        DoEvents
        
    Next i
    
    '' CADASTRAR DADOS
    cadastroProcessamento pDados
    
    '' ATUALIZAR CAMPOS DE RELACIONAMENTOS
    Application.CurrentDb.Execute Replace(qryUpdateProcessamento, "strParametro", "tblCompraNFItem")

Set XDoc = Nothing

End Function